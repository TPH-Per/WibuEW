@model IEnumerable<Ltwhqt.ViewModels.Admin.InventorySnapshotViewModel>
@{
    ViewBag.Title = "Chi tiết tồn kho - " + ViewBag.LocationName;
    var locationName = ViewBag.LocationName as string ?? "N/A";
    var locationType = ViewBag.LocationType as string ?? "N/A";
}

@section Styles {
    <link href="@Url.Content("~/wwwroot/css/areas/admin-dashboard.css")" rel="stylesheet" />
    <style>
        .detail-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        .detail-header h2 {
            margin: 0;
            font-size: 1.75rem;
        }
        .product-row:hover {
            background-color: #f8f9fa;
        }
        .stock-badge {
            font-size: 1.1rem;
            font-weight: 600;
        }
        .low-stock {
            color: #dc3545;
        }
        .good-stock {
            color: #28a745;
        }
    </style>
}

<div class="detail-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h2><i class="bi bi-box-seam me-2"></i>@locationName</h2>
            <p class="mb-0 opacity-90">@locationType</p>
        </div>
        <div>
            <a href="@Url.Action("Index")" class="btn btn-light">
                <i class="bi bi-arrow-left me-1"></i>Quay lại
            </a>
        </div>
    </div>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        Không có sản phẩm nào trong kho này.
    </div>
}
else
{
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list-ul me-2"></i>Danh sách sản phẩm
                    <span class="badge bg-primary ms-2">@Model.Count() SKU</span>
                </h5>
                <button class="btn btn-outline-primary btn-sm" onclick="window.print()">
                    <i class="bi bi-printer me-1"></i>In báo cáo
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 10%;">ID</th>
                        <th style="width: 45%;">Sản phẩm / Variant</th>
                        <th style="width: 15%;" class="text-end">Tồn thực tế</th>
                        <th style="width: 15%;" class="text-end">Đang giữ</th>
                        <th style="width: 15%;" class="text-end">Khả dụng</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        var available = item.Available;
                        var stockClass = available <= item.ReorderLevel ? "low-stock" : "good-stock";
                        
                        <tr class="product-row">
                            <td>
                                <code>#@item.VariantId</code>
                            </td>
                            <td>
                                <strong>@item.VariantName</strong>
                                @if (available <= item.ReorderLevel && available > 0)
                                {
                                    <span class="badge bg-warning text-dark ms-2">
                                        <i class="bi bi-exclamation-triangle"></i> Sắp hết
                                    </span>
                                }
                                else if (available <= 0)
                                {
                                    <span class="badge bg-danger ms-2">
                                        <i class="bi bi-x-circle"></i> Hết hàng
                                    </span>
                                }
                            </td>
                            <td class="text-end">
                                <span class="stock-badge text-primary">
                                    @item.QuantityOnHand.ToString("N0")
                                </span>
                            </td>
                            <td class="text-end">
                                @if (item.QuantityReserved > 0)
                                {
                                    <span class="badge bg-warning text-dark">
                                        @item.QuantityReserved.ToString("N0")
                                    </span>
                                }
                                else
                                {
                                    <span class="text-muted">0</span>
                                }
                            </td>
                            <td class="text-end">
                                <span class="stock-badge @stockClass">
                                    @available.ToString("N0")
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <td colspan="2"><strong>TỔNG CỘNG</strong></td>
                        <td class="text-end">
                            <strong>@Model.Sum(i => i.QuantityOnHand).ToString("N0")</strong>
                        </td>
                        <td class="text-end">
                            <strong>@Model.Sum(i => i.QuantityReserved).ToString("N0")</strong>
                        </td>
                        <td class="text-end">
                            <strong>@Model.Sum(i => i.Available).ToString("N0")</strong>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <div class="mt-4 p-3 bg-light rounded">
        <h6><i class="bi bi-info-circle me-2"></i>Ghi chú:</h6>
        <ul class="mb-0 small text-muted">
            <li><strong>Tồn thực tế:</strong> Số lượng sản phẩm hiện có trong kho</li>
            <li><strong>Đang giữ:</strong> Số lượng đã được đặt trước cho đơn hàng</li>
            <li><strong>Khả dụng:</strong> Số lượng có thể bán = Tồn thực tế - Đang giữ</li>
            <li><strong>Reorder Level:</strong> Mức tồn tối thiểu cần đặt hàng lại</li>
        </ul>
    </div>
}
