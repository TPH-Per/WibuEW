@{
    ViewBag.Title = "POS DEBUG TEST";
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>POS Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { padding: 20px; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; }
        .product-item { padding: 10px; margin: 5px 0; border: 1px solid #ccc; cursor: pointer; }
        .product-item:hover { background: #f0f0f0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ POS Search Debug Test</h1>
        
        <div class="alert alert-info">
            <strong>Branch ID:</strong> @ViewBag.CurrentBranchID<br>
            <strong>User ID:</strong> @ViewBag.CurrentUserID<br>
            <strong>Branch:</strong> @ViewBag.BranchName
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Test 1: Direct API Call</h3>
            </div>
            <div class="card-body">
                <button id="btnTestAPI" class="btn btn-primary">Test SearchProducts API</button>
                <div id="apiResult" class="result"></div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h3>Test 2: Search Box</h3>
            </div>
            <div class="card-body">
                <input type="text" id="searchBox" class="form-control" placeholder="Type 'sousou' or 'test'">
                <div id="searchResults" class="mt-3"></div>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h3>Console Logs</h3>
            </div>
            <div class="card-body">
                <div id="consoleLog" style="font-family: monospace; background: #f5f5f5; padding: 10px; max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        // Intercept console.log
        var originalLog = console.log;
        var logDiv = document.getElementById('consoleLog');
        console.log = function() {
            originalLog.apply(console, arguments);
            var msg = Array.from(arguments).map(a => JSON.stringify(a)).join(' ');
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + msg + '</div>';
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        console.log('Page loaded');
        console.log('jQuery version:', $.fn.jquery);

        // Test 1: Direct API call
        $('#btnTestAPI').click(function() {
            console.log('Testing API...');
            $('#apiResult').html('<div class="spinner-border"></div> Loading...');
            
            $.ajax({
                url: '/Branch/POS/SearchProducts',
                type: 'GET',
                data: { query: 'sousou' },
                success: function(data) {
                    console.log('API Response:', data);
                    var html = '<div class="alert alert-success">‚úÖ Success! Found ' + data.length + ' products</div>';
                    html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    
                    if (data.length > 0) {
                        html += '<h5>Products:</h5>';
                        data.forEach(function(p) {
                            html += '<div class="product-item">';
                            html += '<strong>' + p.name + '</strong><br>';
                            html += 'SKU: ' + p.sku + ' | Price: ' + p.price + '‚Ç´ | Stock: ' + p.stock;
                            html += '</div>';
                        });
                    }
                    
                    $('#apiResult').html(html);
                },
                error: function(xhr, status, error) {
                    console.error('API Error:', error);
                    console.error('Status:', status);
                    console.error('Response:', xhr.responseText);
                    $('#apiResult').html(
                        '<div class="alert alert-danger">‚ùå Error: ' + error + '<br>' +
                        'Status: ' + status + '<br>' +
                        'Response: ' + xhr.responseText + '</div>'
                    );
                }
            });
        });

        // Test 2: Search box with debounce
        var searchTimer;
        $('#searchBox').on('input', function() {
            var query = $(this).val();
            console.log('Search input:', query);
            
            clearTimeout(searchTimer);
            
            if (query.length < 2) {
                $('#searchResults').html('<div class="text-muted">Type at least 2 characters</div>');
                return;
            }
            
            $('#searchResults').html('<div>Searching...</div>');
            
            searchTimer = setTimeout(function() {
                console.log('Executing search for:', query);
                
                $.get('/Branch/POS/SearchProducts', { query: query }, function(data) {
                    console.log('Search results:', data);
                    
                    var html = '';
                    if (data.length === 0) {
                        html = '<div class="alert alert-warning">No products found</div>';
                    } else {
                        html = '<div class="alert alert-success">Found ' + data.length + ' products</div>';
                        data.forEach(function(p) {
                            html += '<div class="product-item">';
                            html += '<h6>' + p.name + '</h6>';
                            html += '<small>SKU: ' + p.sku + ' | Price: ' + p.price.toLocaleString() + '‚Ç´ | Stock: ' + p.stock + '</small>';
                            html += '</div>';
                        });
                    }
                    
                    $('#searchResults').html(html);
                })
                .fail(function(xhr, status, error) {
                    console.error('Search failed:', error);
                    $('#searchResults').html('<div class="alert alert-danger">Error: ' + error + '</div>');
                });
            }, 300);
        });

        // Auto-run test on load
        $(document).ready(function() {
            console.log('Document ready');
            console.log('Test page initialized');
            
            // Auto-click test button after 1 second
            setTimeout(function() {
                console.log('Auto-running API test...');
                $('#btnTestAPI').click();
            }, 1000);
        });
    </script>
</body>
</html>
